<!doctype html>
<html lang="zh-CN" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.ff31de0ff">
<link rel="alternate" type="application/rss+xml" href="/zh-CN/blog/rss.xml" title="Nocalhost Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/blog/atom.xml" title="Nocalhost Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Nocalhost" href="/zh-CN/opensearch.xml">
<link rel="icon" href="/img/favicon.ico">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><title data-react-helmet="true">Blog | Nocalhost</title><meta data-react-helmet="true" property="og:title" content="Blog | Nocalhost"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://nocalhost.dev//zh-CN/blog"><meta data-react-helmet="true" name="docsearch:language" content="zh-CN"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="shortcut icon" href="/zh-CN/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://nocalhost.dev//zh-CN/blog"><link data-react-helmet="true" rel="alternate" href="https://nocalhost.dev//blog" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://nocalhost.dev//zh-CN/blog" hreflang="zh-CN"><link data-react-helmet="true" rel="alternate" href="https://nocalhost.dev//blog" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh-CN/assets/css/styles.6d2063ce.css">
<link rel="preload" href="/zh-CN/assets/js/runtime~main.d744c017.js" as="script">
<link rel="preload" href="/zh-CN/assets/js/main.8cc8344e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">跳转至主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><img src="/zh-CN/img/logo.png" alt="Most productive cloud-native development toolsets" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh-CN/img/logo.png" alt="Most productive cloud-native development toolsets" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Nocalhost</strong></a><a class="navbar__item navbar__link" href="/zh-CN/docs/introduction">文档</a><a class="navbar__item navbar__link" href="/zh-CN/videos">视频</a><a class="navbar__item navbar__link" href="/zh-CN/tools">工具</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-CN/blog">博客</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文（中国）</span></span></a><ul class="dropdown__menu"><li><a href="/blog" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh-CN/blog" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文（中国）</a></li></ul></div><a href="https://github.com/nocalhost/nocalhost" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/zh-CN/"><img src="/zh-CN/img/logo.png" alt="Most productive cloud-native development toolsets" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/zh-CN/img/logo.png" alt="Most productive cloud-native development toolsets" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Nocalhost</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/zh-CN/docs/introduction">文档</a></li><li class="menu__list-item"><a class="menu__link" href="/zh-CN/videos">视频</a></li><li class="menu__list-item"><a class="menu__link" href="/zh-CN/tools">工具</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/zh-CN/blog">博客</a></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist"><span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Languages</span></span></a><ul class="menu__list"><li class="menu__list-item"><a href="/blog" target="_self" rel="noopener noreferrer" class="menu__link" style="text-transform:capitalize">English</a></li><li class="menu__list-item"><a href="/zh-CN/blog" target="_self" rel="noopener noreferrer" class="menu__link dropdown__link--active" style="text-transform:capitalize">中文（中国）</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/nocalhost/nocalhost" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link"></a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">All our posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh-CN/blog/rainbond-debug">微服务远程Debug，Nocalhost + Rainbond微服务开发第二弹</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh-CN/blog/rainbond-dev">使用 Nocalhost 开发 Rainbond 上的微服务应用</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh-CN/blog/0.5.6">Nocalhost v0.5.6 发布</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh-CN/blog/api-six">使用 Nocalhost 开发 Kubernetes 中的 APISIX Controller</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh-CN/blog/docs-translate">Nocalhost 官方文档翻译活动</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh-CN/blog/gm-cd">更美的开发环境发展历程与Nocalhost落地实践</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh-CN/blog/2021/07/05/jimmy">How to debug microservices in Kubernetes with proxy, sidecar or service mesh?</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/zh-CN/blog/2021/01/01/">Redefine Cloud Native Dev Environment</a></li></ul></div></div><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/zh-CN/blog/rainbond-debug">微服务远程Debug，Nocalhost + Rainbond微服务开发第二弹</a></h2><div class="margin-vert--md"><time datetime="2022-07-18T03:23:51.328Z" class="blogPostDate_fNvV">2022年7月18日 · 一分钟阅读</time></div><div class="avatar margin-vert--md"><a href="https://github.com/zzzhangqi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/39754275" alt="Qi Zhang"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/zzzhangqi" target="_blank" rel="noopener noreferrer">Qi Zhang</a></h4><small class="avatar__subtitle">Cloud Native Enthusiasts</small></div></div></header><div class="markdown"><p><img src="https://static.goodrain.com/wechat/nocalhost2/nocalhost.png"></p><p>之前的文章中我们介绍了如何通过 <a href="https://mp.weixin.qq.com/s/kC9P7fvMtJvKK7_TM2LbTw" target="_blank" rel="noopener noreferrer">Nocalhost 快速开发 Rainbond 上的微服务</a>，介绍了基本的开发流程。</p><p>本文将续接上文继续介绍，使用 <a href="https://nocalhost.dev/docs/config/config-overview-en/" target="_blank" rel="noopener noreferrer">Nocalhost 开发配置文件</a> 实现以下内容：</p><ul><li>一键 Run 和 远程Debug</li><li>持久化配置</li><li>开发容器资源限制</li><li>端口转发</li></ul><p><strong>什么是开发配置？</strong></p><p>开发配置是围绕 <code>开发模式</code> 来进行的，例如使用什么镜像来进入 <code>开发模式</code>，是否需要开启持久化来保存开发容器的内容，将哪些文件同步到开发容器中，如何一键调试、一键运行容器内的服务等。 配置了正确且合适的开发配置后，可以在使用 Nocalhost <code>开发模式</code> 时更加得心应手。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="部署-rainbond--springcloud"></a>部署 Rainbond + SpringCloud<a class="hash-link" href="#部署-rainbond--springcloud" title="链接到标题">#</a></h2><p>接下来继续以上文中的 SpringCloud Pig 为例，调试 Java Maven 服务的 Pig-auth 模块。</p><p>项目 Gitee 地址：<a href="https://gitee.com/zhangbigqi/pig" target="_blank" rel="noopener noreferrer">https://gitee.com/zhangbigqi/pig</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="部署-rainbond"></a>部署 Rainbond<a class="hash-link" href="#部署-rainbond" title="链接到标题">#</a></h3><p>这里就不详细介绍 Rainbond 的安装，请参阅 <a href="https://www.rainbond.com/docs/installation/install-with-ui/host-install-with-ui" target="_blank" rel="noopener noreferrer">基于Linux安装Rainbond</a>。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="部署-springcloud"></a>部署 SpringCloud<a class="hash-link" href="#部署-springcloud" title="链接到标题">#</a></h3><p>我们在 Rainbond 内对接了开源应用商店后，在开源应用商店内搜索 <code>Spring Cloud Pig</code> 安装 <code>3.5.0</code>版本。</p><p>来自应用商店安装应用组件的英文名称是自动生成的字符串，需要我们设置一下组件的英文名称（Deployment Name），通过 Nocalhost 连接到集群时可以很直观的分清楚 Deployment 对应的组件。</p><p><img src="https://static.goodrain.com/wechat/nocalhost2/1.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="nocalhost-对接-rainbond"></a>Nocalhost 对接 Rainbond<a class="hash-link" href="#nocalhost-对接-rainbond" title="链接到标题">#</a></h2><ol><li><p>安装 Nocalhost JetBrains Plugin 插件，请参阅文档 <a href="https://nocalhost.dev/docs/installation/" target="_blank" rel="noopener noreferrer">安装Nocalhost JetBrains Plugin 插件</a>。</p></li><li><p>获取 K8s Kubeconfig，请参阅文档 <a href="https://www.rainbond.com/docs/ops-guide/tools/kubectl" target="_blank" rel="noopener noreferrer">获取 Kubeconfig 文件</a>。</p></li><li><p>在 <code>pig</code> 命名空间下，找到工作负载 <code>pig-auth</code> 右击并选择 <code>Dev Config</code> （开发配置）</p><img src="https://static.goodrain.com/wechat/nocalhost2/2.png" width="40%"></li><li><p>将以下配置文件复制到 <code>Dev Config</code> 中。</p></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Deployment Name</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pig</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">auth</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">serviceType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> deployment</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Deployment 主容器名称</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> auth</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">dev</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 开发镜像，该镜像包含了 Java Maven 环境</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry.cn</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hangzhou.aliyuncs.com/zqqq/maven</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3.8.6</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">openjdk</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 默认终端为 bash</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">shell</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> bash</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Rainbond 提供的 StorageClass Name</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">storageClass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rainbondvolumerwx</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 配置开发容器资源</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 4096Mi</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2048Mi</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">persistentVolumeDirs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Maven 依赖包缓存路径，配合 storageClass 一起食用</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /root/.m2/repository</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">capacity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10Gi</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 一键启动命令，安装依赖包和启动 pig-auth 子模块</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mvn</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> install</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&amp;&amp;&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mvn</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> spring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">boot</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">run</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pl</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># 指定子模块启动</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pig</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">auth</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 一键 Debug 命令，安装依赖包和 Debug pig-auth 子模块</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">debug</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mvn</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> install</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&amp;&amp;&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> mvn</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> spring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">boot</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">run</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pl</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># 指定子模块启动</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> pig</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">auth</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># Java Debug 命令</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Dspring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">boot.run.jvmArguments=</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">agentlib</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">jdwp=transport=dt_socket</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">server=y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">suspend=y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">address=5005</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">debug</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 远程端口，对应Debug命令中的 address=5005</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">remoteDebugPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5005</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 选择 Java 语言</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">language</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> java</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 热加载</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">hotReload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 文件同步</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">sync</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> send</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitIgnore</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">deleteProtection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 端口转发，转发容器内的3000端口到本地3999</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">portForward</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 3999</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3000</span></div></div></div><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o">复制</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="一键-run"></a>一键 Run<a class="hash-link" href="#一键-run" title="链接到标题">#</a></h3><ol><li>右击工作负载 <code>pig-auth</code> 。</li><li>选择 Remote Run。</li><li>Nocalhost 会自动进入 DevMode 并执行 Remote Run。</li></ol><p><img src="https://static.goodrain.com/wechat/nocalhost2/3-1.gif"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="一键-debug"></a>一键 Debug<a class="hash-link" href="#一键-debug" title="链接到标题">#</a></h3><ol><li>右击工作负载 <code>pig-auth</code> 。</li><li>选择 Remote Debug。</li><li>Nocalhost 会自动进入 DevMode 并执行 Remote Debug。</li><li>在代码中打上断点，发起请求，进入 IDE Debug 模式。</li></ol><p><img src="https://static.goodrain.com/wechat/nocalhost2/4-1.gif"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="持久化配置"></a>持久化配置<a class="hash-link" href="#持久化配置" title="链接到标题">#</a></h3><p>在开发时，我们希望持久化的文件大多数都是 <code>依赖包</code> <code>日志</code>，本篇文章中也是缓存了 Java 的依赖包。</p><p><code>rainbondvolumerwx</code> 是 Rainbond 默认提供的存储类，填写以下配置后会在当前命名空间下自动创建 PVC，如下：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">storageClass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rainbondvolumerwx                 </span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">persistentVolumeDirs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /root/.m2/repository</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">capacity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10Gi</span></div></div></div><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o">复制</button></div></div><p><img src="https://static.goodrain.com/wechat/nocalhost2/5.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="容器资源限制"></a>容器资源限制<a class="hash-link" href="#容器资源限制" title="链接到标题">#</a></h3><p>限制开发容器的资源，限额能让服务器的资源利用最大化，可以通过以下开发配置修改：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 4096Mi</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2048Mi</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span></div></div></div><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o">复制</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="端口转发"></a>端口转发<a class="hash-link" href="#端口转发" title="链接到标题">#</a></h3><p>转发容器端口到本地，可以通过以下开发配置修改：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">portForward</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 3999</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3000</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># 转发容器 3000 端口到本地 3999 端口</span></div></div></div><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o">复制</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="最后"></a>最后<a class="hash-link" href="#最后" title="链接到标题">#</a></h2><p>当然 Nocalhost 可以同时调试多个微服务，同样的方式只需修改配置文件中的 Deployment Name 和 Containers Name 以及微服务的子模块。</p><p>Nocalhost 还有一些开发配置文中没讲到的，比如：开发环境变量、文件同步的两种模式 <code>pattern</code> <code>gitignore</code> 等等，并且 Nocalhost 支持多种语言，Java 只是其中一种，小伙伴们可以自行探索。</p><p>Nocalhost + Rainbond 让开发、部署更加高效、便捷。</p></div><footer class="row margin-vert--lg"><div class="col"><strong>标签：</strong><a class="margin-horiz--sm" href="/zh-CN/blog/tags/rainbond">Rainbond</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/zh-CN/blog/rainbond-dev">使用 Nocalhost 开发 Rainbond 上的微服务应用</a></h2><div class="margin-vert--md"><time datetime="2022-07-18T03:23:51.328Z" class="blogPostDate_fNvV">2022年7月18日 · 一分钟阅读</time></div><div class="avatar margin-vert--md"><a href="https://github.com/zzzhangqi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/39754275" alt="Qi Zhang"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/zzzhangqi" target="_blank" rel="noopener noreferrer">Qi Zhang</a></h4><small class="avatar__subtitle">Cloud Native Enthusiasts</small></div></div></header><div class="markdown"><p>本文将介绍如何使用 Nocalhost 快速开发 Rainbond 上的微服务应用的开发流程以及实践操作步骤。</p><p>Nocalhost 可以直接在 Kubernetes 中开发应用，Rainbond 可以快速部署微服务项目，无需编写Yaml，Nocalhost 结合 Rainbond 加速我们的微服务开发效率。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="一-简介"></a>一. 简介<a class="hash-link" href="#一-简介" title="链接到标题">#</a></h2><p><strong><a href="https://nocalhost.dev" target="_blank" rel="noopener noreferrer" title="Nocalhost">Nocalhost</a> 是一款开源的基于 IDE 的云原生应用开发工具：</strong></p><ul><li>直接在 Kubernetes 集群中构建、测试和调试应用程序</li><li>提供易于使用的 IDE 插件（支持 VS Code 和 JetBrains），即使在 Kubernetes 集群中进行开发和调试，使用 Nocalhost 之后也能够获得和本地开发一样的开发体验</li><li>使用即时文件同步进行开发： 即时将您的代码更改同步到远端容器，而无需重建镜像或重新启动容器。</li></ul><p><strong><a href="https://www.rainbond.com/docs" target="_blank" rel="noopener noreferrer" title="Rainbond">Rainbond</a> 是一款云原生应用管理平台：</strong></p><ul><li>使用简单，不需要懂容器、Kubernetes和底层复杂技术，支持管理多个Kubernetes集群，和管理企业应用全生命周期。主要功能包括应用开发环境、应用市场、微服务架构、应用交付、应用运维、应用级多云管理等。</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="二-本地--rainbond-开发微服务"></a>二. 本地 + Rainbond 开发微服务<a class="hash-link" href="#二-本地--rainbond-开发微服务" title="链接到标题">#</a></h2><p>在以往的开发模式中，我们在本地 + Rainbond 开发微服务时，要开发的模块我们运行在本地，其他模块运行在 Rainbond 上，我们通过 Rainbond 的网关与本地进行通信、联调。</p><p><img src="https://static.goodrain.com/wechat/nocalhost/19.png"></p><p>这种场景下，我们有以下问题急需解决：</p><ul><li>多人协作开发联调困难</li><li>本地环境差异化</li><li>无法通过注册中心(Nacos)调用其他微服务</li><li>远程Debug较难</li><li>受限于本地资源</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="三-使用-nocalhost--rainbond-开发微服务"></a>三. 使用 Nocalhost + Rainbond 开发微服务<a class="hash-link" href="#三-使用-nocalhost--rainbond-开发微服务" title="链接到标题">#</a></h2><p>现在我们通过 Nocalhost + Rainbond 开发微服务时，所有服务都运行在 Rainbond 上，在开发过程中可以使用 VSCode 插件 Nocalhost 连接进入到 Rainbond 组件中，并将本地代码实时同步到 Rainbond 组件中。多人开发联调时，可通过 Rainbond 内置的 Service Mesh 进行服务之间调用。</p><p><img src="https://static.goodrain.com/wechat/nocalhost/18.png"></p><p><strong>使用 Nocalhost 开发，可以解决本地开发时遇到的问题：</strong></p><ul><li>多人联调开发更便捷</li><li>服务都运行在 Rainbond 上，不再受限于本地</li><li>与生产环境更接近</li><li>远程Debug</li><li>通过注册中心(Nacos)调用其他微服务组件</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="四-实践操作步骤"></a>四. 实践操作步骤<a class="hash-link" href="#四-实践操作步骤" title="链接到标题">#</a></h2><p>Nocalhost 目前支持两种开发模式：</p><ul><li>Replace DevMode</li><li>Duplicate DevMode</li></ul><p>本篇将主要介绍 Replace DevMode，当进入 Replace DevMode 时，Nocalhost 会对 组件 执行以下操作:</p><ol><li>将副本数缩减为 1</li><li>替换容器的镜像为开发镜像</li><li>增加一个 sidecar 容器。</li><li>转发一个本地端口到文件同步服务器。</li><li>启动本地文件同步客户端。</li><li>打开远程终端。</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="41-安装-nocalhost-插件"></a>4.1 安装 Nocalhost 插件<a class="hash-link" href="#41-安装-nocalhost-插件" title="链接到标题">#</a></h3><p>Nocalhost IDE 插件支持 <code>VSCode</code> <code>JetBrains</code>，这里我们主要介绍 <a href="https://nocalhost.dev/docs/installation" target="_blank" rel="noopener noreferrer" title="VSCode 插件安装">VSCode 插件安装</a>参考官网文档。</p><ol><li>打开 VSCode，点击左侧的 <code>Extension</code> 按钮 <img src="https://nocalhost.dev/zh-CN/img/icons/vs-code-icon.jpg" alt="img"> 图标</li><li>在搜索框中输入 <code>Nocalhost</code> 选择 <code>Nocalhost 插件</code>，并点击 <strong>Install</strong> 按钮</li></ol><p><img src="https://static.goodrain.com/wechat/nocalhost/3.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="42-安装-rainbond"></a>4.2 安装 Rainbond<a class="hash-link" href="#42-安装-rainbond" title="链接到标题">#</a></h3><p>我们选择 <a href="https://www.rainbond.com/docs/installation/install-with-ui/host-install-with-ui" target="_blank" rel="noopener noreferrer" title="基于主机安装 Rainbond">基于主机安装 Rainbond</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="43-nocalhost-对接-rainbond-集群"></a>4.3 Nocalhost 对接 Rainbond 集群<a class="hash-link" href="#43-nocalhost-对接-rainbond-集群" title="链接到标题">#</a></h3><ol><li>获取 <code>kubeconfig</code> 文件，进入 Rainbond 集群视图 -&gt; 点击节点配置 -&gt; kubeconfig</li></ol><p><img src="https://static.goodrain.com/wechat/nocalhost/4.png"></p><ol start="2"><li><p>我们将 <code>kubeconfig</code> 文件复制到本地并保存为 <code>yaml</code> 文件。</p></li><li><p>打开 VSCode，点击按钮 <img src="https://nocalhost.dev/zh-CN/img/icons/logo-light.svg" width="3%">，打开 Nocalhost 插件，选择 Connect to Cluster，选择我们 <code>kubeconfig</code> 文件的路径，点击 Add Cluster，添加集群。</p></li><li><p>添加完成后，如下图：</p></li></ol><img src="https://static.goodrain.com/wechat/nocalhost/6.png" width="30%"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="44-在-rainbond-上部署-spring-cloud-应用"></a>4.4 在 Rainbond 上部署 Spring Cloud 应用<a class="hash-link" href="#44-在-rainbond-上部署-spring-cloud-应用" title="链接到标题">#</a></h3><ol><li><p>这里选择从开源应用商店安装 Spring Cloud Pig 微服务组件，在应用商店中搜索 Pig 进行安装。</p></li><li><p>部署完成后，效果如下：</p></li></ol><p><img src="https://static.goodrain.com/wechat/nocalhost/8.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="45-进入-nocalhost-开发模式"></a>4.5 进入 Nocalhost 开发模式<a class="hash-link" href="#45-进入-nocalhost-开发模式" title="链接到标题">#</a></h3><p>上面我们已经在本地 VSCode 中对接好了集群，并且也已经在 Rainbond 中安装了 Spring Cloud Pig 微服务，那么接下来我们在本地 VSCode 中选择其中一个组件进行开发，这里为了效果更明显，选择开发 <code>pig-ui</code> 组件。</p><p><a href="https://gitee.com/zhangbigqi/pig" target="_blank" rel="noopener noreferrer" title="Spring Cloud Pig 后端">Spring Cloud Pig 后端</a></p><p><a href="https://gitee.com/zhangbigqi/pig-ui" target="_blank" rel="noopener noreferrer" title="Spring Cloud Pig 前端">Spring Cloud Pig 前端</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="451-克隆-pig-ui-代码到本地"></a>4.5.1 克隆 Pig-ui 代码到本地<a class="hash-link" href="#451-克隆-pig-ui-代码到本地" title="链接到标题">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://gitee.com/zhangbigqi/pig-ui</span></div></div></div><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o">复制</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="452-启动本地开发"></a>4.5.2 启动本地开发<a class="hash-link" href="#452-启动本地开发" title="链接到标题">#</a></h4><p>打开 VSCode，点击按钮 <img src="https://nocalhost.dev/zh-CN/img/icons/logo-light.svg" width="3%">，找到我们的 Pig-ui 组件，由于该应用是从开源应用商店中安装，Deployment名称是自动生成的字符串，我们需要在组件中查询下。</p><p><img src="https://static.goodrain.com/wechat/nocalhost/9.png"></p><img src="https://static.goodrain.com/wechat/nocalhost/10.png" width="30%"><p>我们点击旁边的🔨进入开发模式，</p><ol><li>提示选择容器，我们选择 <code>gred5f1c</code> 这个容器。 &gt; 另外一个容器是 Rainbond 默认注入的 sidecar 容器，用于组件之间的内部通信。</li><li>提示指定源代码目录，选择我们刚刚克隆下来的代码目录。</li><li>等待片刻后，会默认打开远端容器的终端界面并且将本地项目的文件同步至容器内，如下：</li></ol><p><img src="https://static.goodrain.com/wechat/nocalhost/11.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="453-启动项目"></a>4.5.3 启动项目<a class="hash-link" href="#453-启动项目" title="链接到标题">#</a></h4><ol><li>安装项目依赖，执行</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span></div></div></div><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o">复制</button></div></div><ol start="2"><li>运行项目</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><div tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> run dev</span></div></div></div><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o">复制</button></div></div><p>启动后效果如下，容器内端口为 80</p><p><img src="https://static.goodrain.com/wechat/nocalhost/13.png"></p><ol start="3"><li>开启端口转发，点击按钮 <img src="https://nocalhost.dev/zh-CN/img/icons/logo-light.svg" width="3%">，找到我们的 Deployment，右键选择 Port Forward，Add Port Forward，输入 <code>38000:80</code> 将容器的80端口转发到本地的38000端口。</li></ol><img src="https://static.goodrain.com/wechat/nocalhost/14.png" width="30%"><ol start="4"><li>通过 <code>http://localhost:38000</code> 可以访问到页面，并且也可以正常登录。</li></ol><p><img src="https://static.goodrain.com/wechat/nocalhost/15.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="454-修改代码查看效果"></a>4.5.4 修改代码查看效果<a class="hash-link" href="#454-修改代码查看效果" title="链接到标题">#</a></h4><p>上面已经演示了如果通过本地访问到远端容器内的服务，接下来我们修改代码看下效果。</p><p>修改 <code>src/page/wel.vue</code>，新增一段代码，保存。可以发现，当我们保存的时候，终端中就自动重启了，与本地开发效果一致。</p><p>文件的修改会实时同步到容器中。</p><p><img src="https://static.goodrain.com/wechat/nocalhost/16.png"></p><p>刷新页面<code>http://localhost:38000</code>，可以看到修改的内容已生效。</p><p><img src="https://static.goodrain.com/wechat/nocalhost/17.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="写在最后"></a>写在最后<a class="hash-link" href="#写在最后" title="链接到标题">#</a></h2><p>通过以上的实践步骤，我们已经可以通过 Nocalhost 开发 Rainbond 上的微服务应用，进入云原生快速开发，提升我们的开发效率。</p><p>本文仅介绍了基本的开发，还可以为项目配置 <a href="https://nocalhost.dev/docs/config/config-overview-en" target="_blank" rel="noopener noreferrer" title="Nocalhost开发配置">Nocalhost开发配置</a> 等等，小伙伴们可以自行探索。</p></div><footer class="row margin-vert--lg"><div class="col"><strong>标签：</strong><a class="margin-horiz--sm" href="/zh-CN/blog/tags/rainbond">Rainbond</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/zh-CN/blog/0.5.6">Nocalhost v0.5.6 发布</a></h2><div class="margin-vert--md"><time datetime="2022-07-18T03:23:51.324Z" class="blogPostDate_fNvV">2022年7月18日 · 一分钟阅读</time></div><div class="avatar margin-vert--md"><a href="https://github.com/anurnomeru" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/24870621?v=4" alt="Anur"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/anurnomeru" target="_blank" rel="noopener noreferrer">Anur</a></h4><small class="avatar__subtitle">Backend engineer at Nocalhost Team</small></div></div></header><div class="markdown"><p>Nocalhost v0.5.6已经发布，我们已经修复了一些缺陷，提高了性能并添加了一些新功能。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="whats-new"></a>What&#x27;s new?<a class="hash-link" href="#whats-new" title="链接到标题">#</a></h2><p>我们最近发布了四个比较重要的功能：</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="supports-nodejs-remote-rundebug-and-hotreload-in-jetbrains"></a>Supports Node.js remote Run/Debug and HotReload in JetBrains<a class="hash-link" href="#supports-nodejs-remote-rundebug-and-hotreload-in-jetbrains" title="链接到标题">#</a></h3><p>Nocalhos 现在已经支持 JetBrains 中使用 Node.js 远程运行、调试和实时热加载</p><p><a href="/zh-CN/docs/guides/debug/jetbrains-debug">了解更多关于如何配置 Node.js 远程调试</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="supports-hotreload-in-jetbrains"></a>Supports HotReload in JetBrains<a class="hash-link" href="#supports-hotreload-in-jetbrains" title="链接到标题">#</a></h3><p>Nocalhost 现在支持在 JetBrains 中以 HotReload 的方式进行运行或调试。 当启用此功能时， Nocalhost 将监测实时文件更改，并在开发或远程调试过程中自动重新执行配置好的运行/调试命令。 <iframe width="100%" height="600" src="//player.bilibili.com/player.html?aid=335688273&amp;bvid=BV1sR4y1p7RM&amp;cid=415232002&amp;page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" mark="crwd-mark"> </iframe></p><p><a href="/zh-CN/docs/guides/hot-reload">了解更多关于如何配置 HotReload</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="major-update-for-nocalhost-server"></a>Major update for Nocalhost Server<a class="hash-link" href="#major-update-for-nocalhost-server" title="链接到标题">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="new-ui"></a>New UI<a class="hash-link" href="#new-ui" title="链接到标题">#</a></h4><p>我们打造了一套全新的 Nocalhost Server UI 系统。</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/server/dashboard.gif"></figure><p><a href="/zh-CN/docs/server/deploy-server">尝试我们最新版 Nocalhost Sever</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="meshspace"></a>MeshSpace<a class="hash-link" href="#meshspace" title="链接到标题">#</a></h4><p><strong>MeshSpace</strong> 基于 <a href="https://istio.io/" target="_blank" rel="noopener noreferrer">Istio</a>，允许你通过指定独立路由的 Header 来共享工作负载。</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/server/mesh-space.svg"></figure><p><a href="/zh-CN/docs/server/manage-devspace-mesh">进一步了解 MeshSpace</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="supports-to-share-kubernetes-namespace"></a>Supports to share Kubernetes namespace<a class="hash-link" href="#supports-to-share-kubernetes-namespace" title="链接到标题">#</a></h4><p>你可以使用 Nocalhost Server 轻松地与团队中的任何人分享你的 Kubernetes namespace。</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/server/share.svg"></figure><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="supports-to-store-nocalhost-configuration-in-kubernetes-cluster"></a>Supports to store Nocalhost configuration in Kubernetes cluster<a class="hash-link" href="#supports-to-store-nocalhost-configuration-in-kubernetes-cluster" title="链接到标题">#</a></h3><p>你现在可以轻松地与使用相同的 Kubernetes 集群的任何人共享你的 Nocalhost 配置。</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/config/share-config.png"></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="other-updates"></a>Other Updates<a class="hash-link" href="#other-updates" title="链接到标题">#</a></h2><p><a href="/zh-CN/docs/changelogs/0.5.x#056-2021-09-16">阅读 Nocalhost v0.5.6 的完整更新日志</a></p></div><footer class="row margin-vert--lg"><div class="col"><strong>标签：</strong><a class="margin-horiz--sm" href="/zh-CN/blog/tags/announcement">Announcement</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/zh-CN/blog/api-six">使用 Nocalhost 开发 Kubernetes 中的 APISIX Controller</a></h2><div class="margin-vert--md"><time datetime="2022-07-18T03:23:51.324Z" class="blogPostDate_fNvV">2022年7月18日 · 一分钟阅读</time></div><div class="avatar margin-vert--md"><a href="https://github.com/neaped" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/3713305?v=4" alt="Garry Chen"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/neaped" target="_blank" rel="noopener noreferrer">Garry Chen</a></h4><small class="avatar__subtitle">Product Manager at Nocalhost Team</small></div></div></header><div class="markdown"><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/apisix/apisix-banner.png"></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="链接到标题">#</a></h2><p>本文通过使用 Nocalhost 将本地开发机无缝连接到一个远程 Kubernetes 集群， 让我们可以使用常用的 IDE 来开发和调试 <a href="https://apisix.apache.org/docs/ingress-controller/getting-started" target="_blank" rel="noopener noreferrer">Apache APIX ingress controller</a>。 从而让我们可以使用现有的技术栈来顺畅地开发和调试 K8s 集群上的应用。</p><p>本文包括：</p><ol><li><a href="#deploy-apisix-ingress-controller"> 在 IDE 中部署 APISIX Ingress controlle</a> 到远程 Kubernetes 集群</li><li><a href="#developing">开发</a> 和 <a href="#debugging">调试</a> Kubernetes 集群上的 APISIX ingress controller ，不需要重建容器镜像</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="链接到标题">#</a></h2><ul><li>准备一个可用的 Kubernetes 集群。 可以使用任意拥有命名空间管理权限的 Kubernetes 集群。</li><li>本地已安装好 <a href="https://helm.sh" target="_blank" rel="noopener noreferrer">Helm v3.0+</a></li><li>集群中已安装好 <a href="https://apache.github.io/apisix-helm-chart/docs/en/latest/apisix.html" target="_blank" rel="noopener noreferrer">APISIX</a></li><li>GoLand IDE 2020.03+ (I am using GoLand 2021.2 in this article)</li><li><a href="/zh-CN/docs/installation#install-jetbrains-plugin">安装 Nocalhost JetBrains 插件</a></li><li>安装 <a href="https://golang.org/dl/" target="_blank" rel="noopener noreferrer">Go 1.13</a> 或更高版本</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="deploy-apisix-ingress-controller"></a>Deploy APISIX Ingress Controller<a class="hash-link" href="#deploy-apisix-ingress-controller" title="链接到标题">#</a></h2><p>在 GoLand 中通过 Nocalhost 部署 APISIX Ingress Controller：</p><ol><li>在 GoLand 中打开 Nocalhost 插件</li><li>选择将要部署 APISIX Ingress Controller 的命名空间</li><li>右键点击选定的命名空间, 选择 <strong><code>Deploy Application</code></strong>, 然后选择 <strong><code>Helm Repo</code></strong> 作为安装方法</li><li>在下面的对话框中：<ul><li>在 <code>Name</code> 中输入：<code>apisix-ingress-controller</code></li><li>在 <code>Chart URL</code> 中输入：<code>https://charts.apiseven.com</code></li></ul></li></ol><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/apisix/apisix-ingress-deploy.gif"><figcaption>部署 APISIX ingress controller</figcaption></figure><p>部署完成后，我们通过在 IDE 内启用端口转发来测试 <code>apisix-ingress-controller</code></p><ol><li>在 Nocalhost 插件的 Workloads 中找到 <code>apisix-ingress-controller</code> ，右键点击并选择 <strong><code>Port Forward</code></strong></li><li>添加端口转发 <code>8080:8080</code></li><li>在本地访问 <a href="http://127.0.0.1:8080/healthz" target="_blank" rel="noopener noreferrer"><code>http://127.0.0.1:8080/healthz</code></a> 并检查结果</li></ol><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/apisix/apisix-ingress-test.gif"><figcaption>测试部署是否成功</figcaption></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="developing"></a>Developing<a class="hash-link" href="#developing" title="链接到标题">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-1-start-devmode"></a>Step 1. Start DevMode<a class="hash-link" href="#step-1-start-devmode" title="链接到标题">#</a></h3><ol><li>右键点击 <code>apisix-ingress-controller</code> 工作负载，选择 <strong><code>Dev Config</code></strong></li><li>如果已经将源码克隆到本地，请选择源代码目录。 否则通过输入仓库地址 <a href="https://github.com/apache/apisix-ingress-controller.git" target="_blank" rel="noopener noreferrer">https://github.com/apache/apisix-ingress-controller.git</a> 来让 Nocalhost 克隆源代码到本地</li><li>等待操作完成，Nocalhost 将在进入 DevMode 后在 IDE 内打开远程终端</li></ol><p>现在通过在远程终端中输入以下命令来启动 <code>apisix-ingress-controller</code> 进程：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">go run main.go ingress --config-path conf/config-default.yaml</span></div></div></div><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o">复制</button></div></div><p><code>apisix-ingress-controller</code> 启动后，通过 <code>http://127.0.0.1:8080/healthz</code> 访问服务， 并检查结果</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/apisix/apisix-ingress-devmode.gif"><figcaption>进入开发模式</figcaption></figure><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-2-change-code-and-check-result"></a>Step 2. Change code and check result<a class="hash-link" href="#step-2-change-code-and-check-result" title="链接到标题">#</a></h3><p>现在我们来修改一下代码并看看效果：</p><ol><li>停止 <code>apisix-ingress-controller</code> 进程</li><li>在 Goland 中搜索 <code>healthz</code> 并找到 <code>router.go</code> 文件。 将 <code>healthzResponse</code> 的状态代码从 <code>ok</code> 更改为 <code>Hello Nocalhost</code></li><li>重新启动进程并在本地检查更改结果</li></ol><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/apisix/apisix-ingress-code-change.gif"><figcaption>⭐️   无需重新构建镜像或重启容器，几秒后便可以看到改动的结果   ⭐️ </figcaption></figure><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-3-end-devmode"></a>Step 3. End DevMode<a class="hash-link" href="#step-3-end-devmode" title="链接到标题">#</a></h3><p>现在关闭开发窗口并结束 DevMode：</p><ol><li>右键点击 <code>apisix-ingress-controller</code></li><li>选择 <strong><code>End DevMode</code></strong></li></ol><p>Nocalhost 将使 <code>apisix-ingress-controller</code> 结束 DevMode, 并重置 <code>apisix-ingress-controller</code> 到其原始版本。 启用端口转发来看看结束 DevMode 后的结果。</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/apisix/apisix-ingress-end-devmode.gif"><figcaption>结束 DevMode</figcaption></figure><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>代码修改</h5></div><div class="admonition-content"><p>DevMode 模式下，所有代码更改都只在 <strong>开发容器</strong> 中生效。</p><p>退出 DevMode 后，Nocalhost 将会将远程容器重置为原始状态(进入 DevMode 之前的版本)。 通过这种方式，在退出 DevMode 以后，在 DevMode 模式下做的修改都不会影响原有环境。</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="debugging"></a>Debugging<a class="hash-link" href="#debugging" title="链接到标题">#</a></h2><p>调试应用程序是一件麻烦的事，在 Kubernetes 集群中调试应用程序则更加麻烦。 Nocalhost 可以帮助我们在调试 Kubernetes 集群中的程序时获得和在 IDE 中直接调试本地程序同样的体验。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-1-start-remote-debugging"></a>Step 1. Start remote debugging<a class="hash-link" href="#step-1-start-remote-debugging" title="链接到标题">#</a></h3><p>我们可以通过以下方式开始远程调试</p><ol><li>右键点击 <code>apisix-ingress-controller</code> 并选择 <strong><code>远程调试</code></strong></li><li>Nocalhost 将会先让 <code>apisix-ingress-controller</code> 进入DevMode， 并运行在  <a href="/zh-CN/docs/config/config-develop"><code>dev config</code></a> 定义的调试命令</li></ol><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/apisix/apisix-ingress-remote-debug.gif"><figcaption>开始远程调试</figcaption></figure><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="step-2-step-through-breakpoints"></a>Step 2. Step through breakpoints<a class="hash-link" href="#step-2-step-through-breakpoints" title="链接到标题">#</a></h3><p>在 <code>healthz</code> 函数上设置一个断点。 悬停在行号左侧，然后点击红点。 设置好断点后，在浏览器中访问 <a href="http://127.0.0.1:8080/healthz" target="_blank" rel="noopener noreferrer"><code>http://127.0.0.1:8080/healthz</code></a> ，会触发断点，GoLand 会跳到前台。 点击调试相关按钮可对程序进行调试。</p><p>此外，因为我们启用了 <code>dev.hotReload</code>，所以每次更改代码时，Nocalhost 将自动重新运行调试命令。 在我们频繁更改和调试代码的时候会非常方便。</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/apisix/apisix-ingress-break-reload.gif"><figcaption>设置断点并运行服务</figcaption></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="remote-run"></a>Remote Run<a class="hash-link" href="#remote-run" title="链接到标题">#</a></h2><p>Nocalhost 不仅仅可以远程调试，还为我们在 Kubernetes 集群中运行服务以及热加载提供了一种简单的方式！</p><p>我们可以通过以下步骤使用 <code>remote run</code> 功能：</p><ol><li>右键点击 <code>apisix-ingress-controller</code> ，并选择 <strong><code>Remote Run</code></strong></li><li>Nocalhost 将会先让 <code>apisix-ingress-controller</code> 进入DevMode， 并运行在  <a href="/zh-CN/docs/config/config-develop"><code>dev config</code></a> 定义的运行命令</li></ol><p>每次更改代码完代码后，Nocalhost 都会自动触发运行命令，将程序运行起来。</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/apisix/apisix-ingress-remote-run.gif"><figcaption>Remote run</figcaption></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="链接到标题">#</a></h2><p>现在，我们已经学会如何使用 Nocalhost 来开发和调试 Kubernetes 集群中的 APISX ingress controller。  使用 Nocalhost，我们不需要等待缓慢的本地开发循环反馈，而是通过一种富有成效的云原生开发方式来得到快速的反馈。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="references"></a>References<a class="hash-link" href="#references" title="链接到标题">#</a></h2><ul><li><a href="https://apisix.apache.org/docs/ingress-controller/getting-started" target="_blank" rel="noopener noreferrer">Apache APISIX getting started guide</a></li><li><a href="https://apisix.apache.org/docs/ingress-controller/development" target="_blank" rel="noopener noreferrer">Developing for Apache APISIX Ingress Controller</a></li></ul></div><footer class="row margin-vert--lg"><div class="col"><strong>标签：</strong><a class="margin-horiz--sm" href="/zh-CN/blog/tags/kubernetes">Kubernetes</a><a class="margin-horiz--sm" href="/zh-CN/blog/tags/apisix">APISIX</a><a class="margin-horiz--sm" href="/zh-CN/blog/tags/controller">Controller</a><a class="margin-horiz--sm" href="/zh-CN/blog/tags/development">Development</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/zh-CN/blog/docs-translate">Nocalhost 官方文档翻译活动</a></h2><div class="margin-vert--md"><time datetime="2022-07-18T03:23:51.324Z" class="blogPostDate_fNvV">2022年7月18日 · 一分钟阅读</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="背景"></a>背景<a class="hash-link" href="#背景" title="链接到标题">#</a></h2><p>Nocalhost 的新官网框架已经上线。因为目前 Nocalhost 官方文档只有英文版，这提高了学习和使用 Nocalhost 的门槛，不利于项目的传播和发展。同时翻译工作也能显著提升语言能力，帮助我们拓宽阅读技术资料的广度，故组织本次活动。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="活动流程"></a>活动流程<a class="hash-link" href="#活动流程" title="链接到标题">#</a></h2><p>本次活動可以通过使用 Crowdin 平台或下载源码对文档进行翻译</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="通过-crowndin-进行翻译"></a>通过 Crowndin 进行翻译<a class="hash-link" href="#通过-crowndin-进行翻译" title="链接到标题">#</a></h2><p>翻译项目的的地址在：<a href="https://crowdin.com/project/nocalhost" target="_blank" rel="noopener noreferrer">https://crowdin.com/project/nocalhost</a></p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>账号</h5></div><div class="admonition-content"><p>当进入项目后，需要注册一个 Crowdin 的账号，您也可以通过 GitHub 账号一键登录</p></div></div><ol><li>进入上述地址进入项目</li><li>选择需要翻译的文档，进入在线编辑器</li><li>进行在线翻译</li><li>翻译完成后退出编译器</li></ol><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/translate/translate.gif"></figure><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="翻译要求"></a>翻译要求<a class="hash-link" href="#翻译要求" title="链接到标题">#</a></h3><ul><li>如果使用自动翻译，请<strong>先检查</strong>清楚自动翻译的结果，包括格式和阅读习惯</li><li>数字和英文两边是中文要加空格。</li><li>Nocalhost 和 Nocalhost Server 统一写法。</li><li>翻译完请先阅读一遍，不要出现遗漏段落，保证文章通顺、符合中文阅读习惯。不追求严格一致，可以意译。review 的时候也会检验。</li><li>你和您不要混用，统一使用用 <strong>“你”</strong>。</li><li>不会翻译的词汇可以不翻译，可以在 PR 中说明，review 的时候会查看。</li><li>注意中英文标点符号。</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="注意事项"></a>注意事项<a class="hash-link" href="#注意事项" title="链接到标题">#</a></h3><p>在翻译的时候，请注意原文格式和 Crowdin 生成的标签。比如下图中的 <code>&lt;0&gt;&lt;/0&gt;</code> 和 <code>&lt;1&gt;&lt;/1&gt;</code>。这些标签是 Crowdin 自动生成的，用于替换原文中的图标，特殊格式等。</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/translate/label.png"><figcaption>Crowdin 标签</figcaption></figure><p>Nocalhost 官网使用了 <a href="https://docusaurus.io/" target="_blank" rel="noopener noreferrer">Docusaurus</a>，因此某些特殊符号和格式请注意。</p><p>例如：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">note title</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">内容。。。。。</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">::</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="复制代码到剪贴板" class="copyButton_Ue-o">复制</button></div></div><p>这个是 Docuasurus 的告示（Admonition）方法。在翻译时，<code>note</code> 需要翻译，后面的 <code>title</code> 需要翻译。另外，请注意格式。</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/translate/admonition.png"></figure></div><footer class="row margin-vert--lg"><div class="col"><strong>标签：</strong><a class="margin-horiz--sm" href="/zh-CN/blog/tags/documentation">documentation</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/zh-CN/blog/gm-cd"></a></h2><div class="margin-vert--md"><time datetime="2022-07-18T03:23:51.324Z" class="blogPostDate_fNvV">2022年7月18日 · 一分钟阅读</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"></div></div></header><div class="markdown"><blockquote><p>更美成立于2013年，旗下更美App是专业医美平台， 提供整形、微整形、齿科、眼科、抗衰老等消费医疗服务。更美App平台的业务主要分为三大部分：医美用户社区、健康服务电商及特卖、企业级医疗机构应用平台。 更美致力于帮助求美者更高效地找到合适的医生，降低消费风险；也帮助医生塑造个人品牌。</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="更美的开发环境发展历程"></a>更美的开发环境发展历程<a class="hash-link" href="#更美的开发环境发展历程" title="链接到标题">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="更美架构介绍"></a>更美架构介绍<a class="hash-link" href="#更美架构介绍" title="链接到标题">#</a></h3><p>更美目前的整体技术架构形式为微服务+多语言，基于云厂商进行容器化部署。微服务基于功能分为业务逻辑层、核心服务层、底层服务层。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="最初的本地开发环境"></a>最初的本地开发环境<a class="hash-link" href="#最初的本地开发环境" title="链接到标题">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="开发模式"></a>开发模式<a class="hash-link" href="#开发模式" title="链接到标题">#</a></h4><p>在更美基础团队最初的开发模式中，所有的开发和调试工作都是在本地进行的。在上面提到的服务分层，业务逻辑和核心服务是最常变动开发的服务。底层服务层相对稳定，例如passport服务，一般不会变动，提供基础的接口支持。开发人员在个人开发环境运行服务、调试代码。联调服务时，在办公网络下暴露自己电脑的网络接口。底层服务只作为服务端，不会作为客户端请求其他服务，可以部署在云端测试环境，通过打通办公网络与云端测试环境网络的方式，暴露给开发人员。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="存在问题"></a>存在问题<a class="hash-link" href="#存在问题" title="链接到标题">#</a></h4><p>在这种开发模式下，存在如下几个问题：</p><ol><li>开发人员本地微服务环境难以搭建。在微服务的架构下，一套环境有几十个微服务，每个服务都需要相对独立的运行环境。</li><li>开发人员需要在本地同时运行多个服务，对开发机的要求极高。一般的个人笔记本电脑难以支撑及时升级配置，也难以完成支撑一整套测试环境的运行，极大的提升成本，降低开发效率。</li><li>测试环境供不应求，资源冗余，成本上升。开发环境与测试环境分离，需求开发完成提交代码到测试环境时，尝尝遇到上一个需求还在测试中，占用环境阻塞提测。</li><li>创建多套完全独立的测试环境，在一定程度上可以缓解阻塞的情况，但是带来了更多的资源冗余问题。每一套环境，都需要跑整套的微服务、底层数据和配置管理。资源消耗、运维压力都很大。</li><li>在业务需求多、周期紧张的情况下，仍旧无法很好的支持多分支、多feature并行开发、并行测试的需求</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="基于gitops的云原生开发环境"></a>基于GitOps的云原生开发环境<a class="hash-link" href="#基于gitops的云原生开发环境" title="链接到标题">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="什么是gitops"></a>什么是GitOps<a class="hash-link" href="#什么是gitops" title="链接到标题">#</a></h4><blockquote><p>GitOps 是一套使用 Git 来管理基础架构和应用配置的实践，GitOps 在运行过程中以 Git 为声明性基础架构和应用的单一事实来源，Git 仓库包含系统的全部状态（集群部署的mainfest file）。</p></blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="新环境架构及现状"></a>新环境架构及现状<a class="hash-link" href="#新环境架构及现状" title="链接到标题">#</a></h4><p>面对之前存在的种种痛点和问题，我们的架构运维团队一直在探索和优化整体的架构新模式。首先，服务部署形式全部容器化，由主机部署模式，转变为基于k8s的容器化部署。引入了多种开源工具，基于云原生生态，搭建了一整套的自动化开发测试体系。实现了整个开发测试流程运维无介入的GitOps体系。极大的解放了人力，提高的迭代效率。</p><p>在新的测试环境体系中，为了解决多分支、多feature并行测试的需求，我们引入了serviceMesh工具Istio，做流量管理。通过Istio流量分发，串联多套测试环境。测试环境维护一套基于当前线上最新分支构建的base环境。所有微服务在未进入开发周期中，只保持base环境的最小化运行。进入开发周期的微服务，可以在根据命名规范切出对应分支后，部署对应分支环境，测试流量通过Istio IngressGateway进入后，根据不同的规则进行路由。实现了一套基础环境+多套feature环境的大测试集群。</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gu3nrcojdrj60kg0l6aau02.jpg" alt="未命名文件"></p><p>整体环境的自动化流转基于git代码提交来实现，在代码提交后，自动实现镜像构建、容器发布、流量切换、群通知，极大提升开发迭代效率。主要实现如下能力：</p><ul><li>一套base测试环境，减少资源冗余</li></ul><blockquote><p>基础环境同步当前线上最新代码，自动触发部署。确保base环境永远与生产环境相同</p></blockquote><ul><li>多套feature环境</li></ul><blockquote><p>根据分支命名规则，同feature下的不同微服务形成一套小环境，流量与其他feature隔离；</p><p>各feature对应的小环境相互独立；</p><p>feature中的服务请求到了不在开发中的微服务，把流量路由到base环境。实现底层服务的对多环境共享。</p><p>开发、测试环境一体化。在独立feature环境下完成开发联调和提测。</p></blockquote><ul><li>GitOps自动化运维体系 &gt; 基于git代码的变更实现自动化流程的运转 &gt; &gt; 基于git仓库来声明整体的基础架构</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="基于coding的cicd体系"></a>基于coding的CICD体系<a class="hash-link" href="#基于coding的cicd体系" title="链接到标题">#</a></h4><p>在持续集成阶段，我们采用git+jenkins+docker镜像仓库来实现。符合开发命名规范的代码分支变更后，触发jenkins的构建流程，完成后push镜像到仓库。</p><p>在持续交付阶段，采用的是Netflix 开源持续交付平台 Spinnaker。在CI流程完成后触发CD流程，spinnaker自动完成新分支版本的创建、部署、流量分发及结果通知触发。</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gu3mspibqhj60sl05874n02.jpg" alt="image-20210903184802962"></p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gu3mw5cijoj60dk0abgm102.jpg" alt="image-20210903185123216"></p><p>后续我们逐步把CD流程在逐步迁移到腾讯云的coding平台。coding的CICD发布体系，也是基于jenkins+spinnaker来实现，并进行了一系列优化。与我们的技术栈非常契合，迁移成本非常小，能有效降低我们的运维成本。</p><p>目前我们的生产环境已经完成全部迁移，可以基于coding发布单实现服务的快速发布。整体发布过程由开发人员提交发布，测试人员确认后，即进入自动化发布流程。相比之前的上线开发与测试线下沟通确认可上线后，再找运维来处理发布，更加合理也更加灵活。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="当前主要痛点"></a>当前主要痛点<a class="hash-link" href="#当前主要痛点" title="链接到标题">#</a></h3><ol><li>开发测试阶段如何快速联调应用。在当前的架构形式下，整体的流程都是正常运转的。但是开发人员的code环境和开发联调、测试环境是分离的，每一次修改都需要数分钟的时间等待CICD流程的完成，才能实际验证修改效果。比较影响开发人员的开发体验，降低工作效率。</li><li>初始开发环境构建难度大。本地仍旧需要开发人员针对不同的微服务，设置不同语言、甚至不同语言版本的开发环境。微服务越多，本地开发环境越难以搭建。新入职的初级开发工程师，甚至需要花费数天乃至一周来搭建自己的开发环境。</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="nocalhost的到来"></a>Nocalhost的到来<a class="hash-link" href="#nocalhost的到来" title="链接到标题">#</a></h2><p>为了解决目前最主要的痛点，我们一直在调研本地容器化开发、云端开发等各种开发模式与开发工具，来提升开发体验。我们调研过多种方案与工具，最终发现Nocalhost的出现，非常契合我们目前的架构体系，也能最大程度解决我们现在遇到的痛点。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="nocalhost是什么"></a>Nocalhost是什么<a class="hash-link" href="#nocalhost是什么" title="链接到标题">#</a></h3><p>根据官网介绍，Nocalhost 一词源于 No Local，它是一款基于 IDE 的云原生开发工具，提供实时的云原生应用开发体验。</p><p>在Nocalhost中开发基于云端的应用时，任何代码更改都可以立即在远程端生效，无需重新构建新镜像。这可以缩短整个开发反馈循环周期并大幅提高研发效率。有团队把nocalhost称之为容器时代的rsync工具。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="nocalhost带来了什么"></a>Nocalhost带来了什么<a class="hash-link" href="#nocalhost带来了什么" title="链接到标题">#</a></h3><p>开发中的优势：</p><ul><li>环境一致性：开发环境与生产环境统一由运维团队维护和部署，整体环境一致性非常高；</li><li>反馈及时性：在nocalhost开发模式下，开发人员在IDE中的代码编辑可实现保存即生效，与本地开发没有太大差别；</li><li>环境易搭建：即使是新人入职，本地没有开发环境。那他在常用的IDE中安装插件后，运维提供授权即可连接云端K8S测试集群，即时进入coding状态；</li><li>资源易拓展：开发不再受限于开发机的计算资源，可随时借助云端集群扩展资源。</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="nocalhost-in-更美"></a>Nocalhost in 更美<a class="hash-link" href="#nocalhost-in-更美" title="链接到标题">#</a></h3><p>下图是一张通过Nocalhost VScode插件进入云端的开发模式，左侧可以遍历显示所有容器的当前开发状态，代码编辑窗口的保存可实时同步到容器触发重载；最下面的终端其实是已经远程到容器内的输出了，可以看到容器内running进程的实时反馈。</p><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gu3p25shr1j61bx0u00ze02.jpg" alt="image-20210903200621789"></p><p>可以看到，在进入nocalhost开发模式后，完全可以实现类似于本地开发模式的即改即生效的效果，开发过程非常舒适。对于编译型语言，既可以在本地编译，也可以直接在云端编译。</p><p>根据参与体验的开发人员反馈，使用nocalhost开发，能大约提升30%的开发效率，效果非常可观。我们也在与nocalhost团队保持沟通、持续反馈使用体验和过程中遇到的一些问题，希望这款工具能越来越好。我们也会尝试在团队内继续推进工具的落地，助力我们进一步提升团队工作效率。十分期待nocalhost的进一步发展</p></div></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/zh-CN/blog/2021/07/05/jimmy">How to debug microservices in Kubernetes with proxy, sidecar or service mesh?</a></h2><div class="margin-vert--md"><time datetime="2021-07-05T00:00:00.000Z" class="blogPostDate_fNvV">2021年7月5日 · 一分钟阅读</time></div><div class="avatar margin-vert--md"><a href="https://github.com/rootsongjc" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/3328185?v=4" alt="Jimmy Song"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/rootsongjc" target="_blank" rel="noopener noreferrer">Jimmy Song</a></h4><small class="avatar__subtitle">Developer advocate at Tetrate</small></div></div></header><div class="markdown"><blockquote><p>This blog is originally posted on <a href="https://jimmysong.io/en/blog/how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh/" target="_blank" rel="noopener noreferrer">Jimmy&#x27;s Blog</a></p></blockquote><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh"></a>How to debug microservices in Kubernetes with proxy, sidecar or service mesh?<a class="hash-link" href="#how-to-debug-microservices-in-kubernetes-with-proxy-sidecar-or-service-mesh" title="链接到标题">#</a></h1><p>This article explains three patterns/tools for debugging microservices in Kubernetes and the changes brought by the introduction of Istio for debugging microservices.</p><p>Kubernetes is arguably the best environment for running microservices so far, but the experience of debugging microservices in a Kubernetes environment may not be as user-friendly. This article will show you how to debug microservices in Kubernetes, introduce common tools, and explain how the introduction of Istio impacts debugging microservices.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="debugging-microservices-is-vastly-different-from-traditional-monolithic-applications"></a>Debugging microservices is vastly different from traditional monolithic applications<a class="hash-link" href="#debugging-microservices-is-vastly-different-from-traditional-monolithic-applications" title="链接到标题">#</a></h2><p>The debugging of microservices has been a long-standing problem for software developers. This challenge does not exist in traditional monolithic applications because developers can leverage the debugger in IDEs to add breakpoints, modify environment variables, single-step execution, etc. for their applications, all of which provide great help in software debugging. With the popularity of Kubernetes, the debugging of microservices becomes a thorny issue, where the following issues are more complicated than the debugging of traditional monolithic applications.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="multiple-dependencies"></a>Multiple dependencies<a class="hash-link" href="#multiple-dependencies" title="链接到标题">#</a></h3><p>A microservice often depends on multiple other microservices, some shared volumes across multiple microservices, and authorizations based on service accounts. When debugging a microservice, how do you deploy other dependent services to quickly build a latest set of staging environments?</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="access-from-a-local-machine"></a>Access from a local machine<a class="hash-link" href="#access-from-a-local-machine" title="链接到标题">#</a></h3><p>When microservices are running on a developer’s local computer, there is usually no direct access to the services in a Kubernetes cluster. How can you debug microservices deployed in a Kubernetes cluster as if they were local services?</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="slow-development-loop"></a>Slow development loop<a class="hash-link" href="#slow-development-loop" title="链接到标题">#</a></h3><p>Usually, it takes a long process to update the code and build it into an image before pushing it to the cluster. How do you speed up the development cycle? Let’s look at the tools that address those challenges.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tools"></a>Tools<a class="hash-link" href="#tools" title="链接到标题">#</a></h2><p>The main solutions for debugging microservices in Kubernetes are:</p><ul><li>Proxy: by building a VPN, deploying a proxy in the Kubernetes cluster, and adding local debug endpoints to make the services in Kubernetes directly accessible to local applications, your architecture will look like [ local service ] &lt;-&gt; [ proxy ] &lt;-&gt; [ app in Kubernetes ].</li><li>Sidecar: Inject a sidecar into the pod of the microservice to be debugged to intercept all traffic to and from the service, so that the service can be tracked and monitored, and the service can also be debugged in this sidecar.</li><li>Service Mesh: To get an overall picture of the application, inject sidecars into all microservices so that you can get a dashboard that monitors global status.</li></ul><p>Here are three typical open source projects that implement the above solutions, each of which can help you debug microservices from a different perspective. You can apply them at different stages of software development and they can be said to be complementary to each other.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="proxy--debugging-microservices-with-telepresence"></a>Proxy – debugging microservices with Telepresence<a class="hash-link" href="#proxy--debugging-microservices-with-telepresence" title="链接到标题">#</a></h3><p><a href="https://www.telepresence.io/" target="_blank" rel="noopener noreferrer">Telepresence</a> is essentially a local proxy that proxies data volumes, environment variables, and networks in a Kubernetes cluster locally. The following diagram shows the main usage scenarios for Telepresence.</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/how-to-debug-microservices/telepresence.jpeg"><figcaption>Proxy mode: Telepresence</figcaption></figure><p>Users need to manually execute the telepresence command locally, which will automatically deploy the agent to Kubernetes. Once the agent has been deployed,</p><ul><li>Local services will have complete access to other services in the Kubernetes cluster, environment variables, Secret, ConfigMap, etc.</li><li>Services in the cluster also have direct access to the locally exposed endpoints.</li></ul><p>However, this approach requires users to run multiple commands while debugging locally, and in some network environments it may not be possible to establish a VPN connection to the Kubernetes cluster.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sidecar--debugging-microservices-with-nocalhost"></a>Sidecar – debugging microservices with Nocalhost<a class="hash-link" href="#sidecar--debugging-microservices-with-nocalhost" title="链接到标题">#</a></h3><p><a href="https://nocalhost.dev/" target="_blank" rel="noopener noreferrer">Nocalhost</a> is a Kubernetes-based cloud development environment. To use it, you just need to install a plugin in your IDE – VS Code to extend Kubernetes and shorten the development feedback cycle. The development environment can be isolated by creating different namespaces for different users and using ServiceAccount when binding to different user corners. Nocalhost also provides a web console and API for administrators to manage different development environments.</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/how-to-debug-microservices/sidecar-nocalhost.jpeg"><figcaption>Sidecar mode: Nocalhost</figcaption></figure><p>As long as you have a Kubernetes cluster and have admin rights to the cluster, you can refer to the <a href="/zh-CN/docs/quick-start">Nocalhost documentation</a> to quickly start trying it out. To use the Nocalhost plugin in VS Code, you need to configure the Kubernetes cluster in the plugin first.</p><ol><li>Select the Kubeconfig file you just exported or copy and paste the contents of the file directly into the configuration.</li><li>Then select the service you need to test and select the corresponding Dev Container. VS Code will automatically open a new code window.</li></ol><p>Here is an example of the <a href="https://istio.io/latest/docs/examples/bookinfo/" target="_blank" rel="noopener noreferrer">bookinfo sample</a> provided by Istio. You can open the cloned code in your local IDE and click the hammer next to the code file to enter development mode. Selecting the corresponding DevContainer and Nocalhost will automatically inject a development container sidecar into the pod and automatically enter the container in the terminal, as shown in the following figure.</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/how-to-debug-microservices/nocalhost-vs-code.jpeg"><figcaption>Nocalhost VS Code</figcaption></figure><p>In development mode, the code is modified locally without rebuilding the image, and the remote development environment takes effect in real time, which can greatly accelerate the development speed. At the same time, Nocalhost also provides a server for managing the development environment and user rights, as shown in the following figure.</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/how-to-debug-microservices/nocalhost-web-admin.jpeg"><figcaption>Nocalhost Server</figcaption></figure><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="service-mesh--debugging-microservices-with-istio"></a>Service Mesh – debugging microservices with Istio<a class="hash-link" href="#service-mesh--debugging-microservices-with-istio" title="链接到标题">#</a></h3><p>The above method of using proxy and sidecar can only debug one service at a time. You’ll need a mesh to get the global status of the application, such as the metrics of the service obtained, and debug the performance of the service by understanding the dependency and invocation process of the service through distributed tracing. These observability features need to be implemented by injecting sidecar uniformly for all services. And, when your services are in the process of migrating from VMs to Kubernetes, using Istio can bring VMs and Kubernetes into a single network plane (as shown below), making it easy for developers to debug and do incremental migrations.</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/how-to-debug-microservices/istio-service-mesh.jpeg"><figcaption>Service Mesh mode: Istio</figcaption></figure><p>Of course, these benefits do not come without a “cost.” With the introduction of Istio, your Kubernetes services will need to adhere to the Istio naming convention and you’ll need to know how to debug microservices using the Istioctl command line and logging.</p><ul><li>Use the <em>istioctl analyze</em> command to debug the deployment of microservices in your cluster, and you can use YAML files to examine the deployment of resources in a namespace or across your cluster.</li><li>Use <em>istioctl proxy-config secret</em> to ensure that the secret of a pod in a service mesh is loaded correctly and is valid.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="summary"></a>Summary<a class="hash-link" href="#summary" title="链接到标题">#</a></h2><p>In the process of microservicing applications and migrating from virtual machines to Kubernetes, developers need to make a lot of changes in their mindset and habits. By building a VPN between local and Kubernetes via proxy, developers can easily debug services in Kubernetes as if they were local services. By injecting a sidecar into the pod, you can achieve real-time debugging and speed up the development process. Finally, the Istio service mesh truly enables global observability, and you can also use tools like <a href="https://www.tetrate.io/tetrate-service-bridge/" target="_blank" rel="noopener noreferrer">Tetrate Service Bridge</a> to manage heterogeneous platforms, helping you gradually move from monolithic applications to microservices.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>标签：</strong><a class="margin-horiz--sm" href="/zh-CN/blog/tags/kubernetes">Kubernetes</a><a class="margin-horiz--sm" href="/zh-CN/blog/tags/cloud-native">Cloud-Native</a><a class="margin-horiz--sm" href="/zh-CN/blog/tags/microservice">Microservice</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/zh-CN/blog/2021/01/01/">Redefine Cloud Native Dev Environment</a></h2><div class="margin-vert--md"><time datetime="2021-01-01T00:00:00.000Z" class="blogPostDate_fNvV">2021年1月1日 · 一分钟阅读</time></div><div class="avatar margin-vert--md"><a href="https://github.com/lyzhang1999" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/8142348?v=4" alt="Wang Wei"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/lyzhang1999" target="_blank" rel="noopener noreferrer">Wang Wei</a></h4><small class="avatar__subtitle">Nocalhost Core Team</small></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="preface"></a>Preface<a class="hash-link" href="#preface" title="链接到标题">#</a></h2><p>With the rapid development of business, the organizational structure of the technical department has been continuously expanded and adjusted horizontally and vertically. At the same time, the enterprise&#x27;s production materials: application systems, have also become larger and larger. In order to adapt the application system to the adjustment of the enterprise organizational structure and sort out the boundaries of the organizational structure for application rights and responsibilities, most organizations will choose to use the &quot;microservice&quot; architecture to split the application system horizontally, so that the maintenance boundary of the application system is adapted The power and responsibility boundary of the organizational structure.</p><p>Generally speaking, the larger the organizational structure, the more detailed the application system will be, and the number of &quot;microservices&quot; will also increase. In the practice of splitting &quot;microservices&quot;, it is easy to mark the authority and responsibility boundaries of the organizational structure into the splitting granularity of &quot;microservices&quot;, which may lead to too fine granularity of &quot;microservices&quot;. The problem of further sharp increase in number. In the end, the calling relationship between &quot;microservices&quot; is like cross-departmental collaboration, and it has become more and more complex. The problem is particularly prominent when you want to add new requirements.</p><p>While &quot;microservices&quot; bring convenience, it also brings additional challenges for developers: how to quickly start a complete development environment? The development requirements depend on how other colleagues can coordinate and debug? How to quickly debug these microservices?</p><p>For managers, it also brings a series of challenges: how to manage the development environment of developers? How to let new colleagues quickly develop?</p><p>Imagine what difficulties would you encounter when developing a cloud-native application consisting of 200 &quot;microservices&quot;?</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="localhost-era"></a>Localhost era<a class="hash-link" href="#localhost-era" title="链接到标题">#</a></h2><p>In the era of monolithic applications, it is extremely friendly to developers. Developers use the local machine to run the application, modify the code to take effect in real time, and visit Localhost through a browser to view the code effect in real time.</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/2021-01-01/local.png"></figure><p>Monolithic applications are different from &quot;microservices&quot; applications. Monolithic applications are organized as &quot;ALL-IN-ONE&quot;. All calling relationships are limited to their own classes and functions, and the hardware requirements of applications are generally not too high.</p><p>The development of &quot;microservice&quot; applications is quite different. Due to the mutual dependence, when a certain function or microservice needs to be developed, all dependent services have to be activated. With the increase in the number of microservices, more and more local resources are needed to develop applications, which ultimately leads to the local inability to meet the configuration requirements of development.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cloud-native-liberates-deployment-and-operation-what-about-development"></a>Cloud Native liberates deployment and operation, What about development?<a class="hash-link" href="#cloud-native-liberates-deployment-and-operation-what-about-development" title="链接到标题">#</a></h2><p>The popularity of cloud native and Kubernetes further shields the complexity of &quot;microservice&quot; applications, which is mainly reflected in the deployment and operation and maintenance stages.</p><p>In order to solve the problem of environmental consistency in the development, testing, and production stages of microservice applications, modern microservice application development will package each component into a Docker image and deploy it in the form of workload. Using continuous integration and continuous deployment in the DevOps pipeline, combined with Kubernetes probes, HPA, and application self-healing capabilities, completely liberated the deployment and operation and maintenance of microservice applications.</p><p>But we overlooked a key node: the development phase.</p><p>After microservice applications are packaged with Kubernetes workloads, the problem of rapid application startup in the development process is solved. Developers only need to install a single-node Kubernetes cluster locally, such as Minikube, Kind, etc., to quickly start microservice applications.</p><p>But for developers, the original monolithic application development experience no longer exists. Since the application is difficult to run outside of the Docker container, each code modification needs to go through the following steps:</p><ul><li>Execute docker build to build the image</li><li>Execute docker tag to tag the image</li><li>Execute docker push to push the image to the warehouse</li><li>Modify the image version of the Kubernetes workload</li><li>Wait for the mirror pull to end</li><li>Wait for the Pod to rebuild</li><li>View the modified code effect</li></ul><p>This directly slows down the cyclic feedback process of development, and each modification requires several minutes or even ten minutes of waiting time.</p><figure class="img-frame"><img class="gif-img" src="/zh-CN/img/blog/2021-01-01/circle-en.png"></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="redefine-cloud-native-dev-environment"></a>Redefine Cloud Native Dev Environment<a class="hash-link" href="#redefine-cloud-native-dev-environment" title="链接到标题">#</a></h2><blockquote><p>Nocalhost is a Cloud Native development environment, hoping to make developing cloud-native applications as primitive and simple as developing a single application.</p></blockquote><p>Nocalhost reorganized the roles and resources involved in the development process:</p><ul><li>Team manager</li><li>Developer</li><li>Application</li><li>Cluster</li><li>Development Space</li></ul><p>Through the reintegration of these roles and resources, Nocalhost redefines the cloud-native development environment and brings a new cloud-native development experience.</p><p>In order to quickly understand the cloud-native development environment redefined by Nocalhost, let us first stand in different roles and see what Nocalhost can bring to them.</p><p>Developer:</p><ul><li>Get rid of the need to rebuild a new image for each modification and long-term loop feedback, and the modified code will take effect immediately.</li><li>One-click deployment of the development environment, get rid of the limitations of local environment construction and insufficient resources.</li><li>Link between local IDE editor and development environment, support remote debugging.</li><li>Graphical IDE plug-in, no need to be familiar with kubectl commands to complete development in cloud native environment.</li></ul><p>Manager:</p><ul><li>Unified management of microservice application packages, reducing application maintenance costs.</li><li>Unified management of the development environment and cluster, improve the utilization of cluster resources, and have isolation characteristics.</li><li>Quickly allocate development environment for new employees, and application development can be carried out immediately after the allocation of the environment.</li><li>Flexible development environment resources can be destroyed when used up, reducing development costs.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="quick-start"></a>Quick Start<a class="hash-link" href="#quick-start" title="链接到标题">#</a></h2><p><a href="/zh-CN/docs/quick-start">Try to use Nocalhost for the easier and faster cloud-native application development</a></p><p>Taking Nocalhost&#x27;s built-in Demo: Bookinfo as an example, the development of Productpage microservices has become the following simple steps:</p><ol><li>Connect to remote Kubernetes cluster by click</li><li>Select the workload that need to develop, enter development mode</li><li>Nocalhost IDE plugin will automatically sync the source code to remote <code>DevContainer</code></li><li>Change the code and see the change under seconds without rebuild image or restart remote POD. <iframe width="100%" height="430" src="https://www.youtube.com/embed/M7i-SR531is" title="Nocalhost Quick Demo" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" mark="crwd-mark"></iframe></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="landing-case"></a>Landing case<a class="hash-link" href="#landing-case" title="链接到标题">#</a></h2><p>Currently, Tencent Cloud <a href="http://coding.net/" target="_blank" rel="noopener noreferrer">CODING DevOps</a> (nearly 200 microservices) is using Nocalhost for development. Practice has verified that Nocalhost can greatly improve development efficiency and shorten feedback loops.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="open-source-and-community-co-construction"></a>Open source and community co-construction<a class="hash-link" href="#open-source-and-community-co-construction" title="链接到标题">#</a></h2><p>Nocalhost is currently fully open source and has entered CNCF Landscape: <a href="https://landscape.cncf.io/" target="_blank" rel="noopener noreferrer">https://landscape.cncf.io/</a></p><p><a href="https://github.com/nocalhost/nocalhost" target="_blank" rel="noopener noreferrer">Our Github Repo</a>.</p><p>We are using Apache-2.0 open source agreement, can use unlimited free.</p><p>For more information about Nocalhost, please visit our <a href="/zh-CN/docs/introduction">documentations</a>.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>标签：</strong><a class="margin-horiz--sm" href="/zh-CN/blog/tags/kubernetes">Kubernetes</a><a class="margin-horiz--sm" href="/zh-CN/blog/tags/cloud-native">Cloud-Native</a></div></footer></article><nav class="pagination-nav" aria-label="博客列表页面导航"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/quick-start">快速开始</a></li><li class="footer__item"><a href="https://github.com/nocalhost/nocalhost" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github 源码仓库</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/introduction">文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a href="https://nocalhost.slack.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://twitter.com/nocalhost" target="_blank" rel="noopener noreferrer" class="footer__link-item">推特（Twitter）</a></li><li class="footer__item"><a href="https://www.linkedin.com/in/nocalhost/" target="_blank" rel="noopener noreferrer" class="footer__link-item">领英</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/blog">博客</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">版权 © 2021 Nocalhost | 由 <a href="https://coding.net/" target="_blank">Coding.net 发起</a></div></div></div></footer></div>
<script src="/zh-CN/assets/js/runtime~main.d744c017.js"></script>
<script src="/zh-CN/assets/js/main.8cc8344e.js"></script>
</body>
</html>