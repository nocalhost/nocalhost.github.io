"use strict";(self.webpackChunknh_docs=self.webpackChunknh_docs||[]).push([[4996],{3905:function(e,t,o){o.d(t,{Zo:function(){return u},kt:function(){return m}});var n=o(67294);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},u=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var o=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=c(o),m=r,h=d["".concat(s,".").concat(m)]||d[m]||p[m]||i;return o?n.createElement(h,a(a({ref:t},u),{},{components:o})):n.createElement(h,a({ref:t},u))}));function m(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=o.length,a=new Array(i);a[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,a[1]=l;for(var c=2;c<i;c++)a[c]=o[c];return n.createElement.apply(null,a)}return n.createElement.apply(null,o)}d.displayName="MDXCreateElement"},13919:function(e,t,o){function n(e){return!0===/^(\w*:|\/\/)/.test(e)}function r(e){return void 0!==e&&!n(e)}o.d(t,{b:function(){return n},Z:function(){return r}})},44996:function(e,t,o){o.d(t,{C:function(){return i},Z:function(){return a}});var n=o(52263),r=o(13919);function i(){var e=(0,n.Z)().siteConfig,t=(e=void 0===e?{}:e).baseUrl,o=void 0===t?"/":t,i=e.url;return{withBaseUrl:function(e,t){return function(e,t,o,n){var i=void 0===n?{}:n,a=i.forcePrependBaseUrl,l=void 0!==a&&a,s=i.absolute,c=void 0!==s&&s;if(!o)return o;if(o.startsWith("#"))return o;if((0,r.b)(o))return o;if(l)return t+o;var u=o.startsWith(t)?o:t+o.replace(/^\//,"");return c?e+u:u}(i,o,e,t)}}}function a(e,t){return void 0===t&&(t={}),(0,i().withBaseUrl)(e,t)}},58215:function(e,t,o){var n=o(67294);t.Z=function(e){var t=e.children,o=e.hidden,r=e.className;return n.createElement("div",{role:"tabpanel",hidden:o,className:r},t)}},41395:function(e,t,o){o.d(t,{Z:function(){return u}});var n=o(67294),r=o(80944),i=o(86010),a="tabItem_1uMI",l="tabItemActive_2DSg";var s=37,c=39;var u=function(e){var t=e.lazy,o=e.block,u=e.defaultValue,p=e.values,d=e.groupId,m=e.className,h=(0,r.Z)(),f=h.tabGroupChoices,v=h.setTabGroupChoices,g=(0,n.useState)(u),b=g[0],k=g[1],y=n.Children.toArray(e.children),N=[];if(null!=d){var w=f[d];null!=w&&w!==b&&p.some((function(e){return e.value===w}))&&k(w)}var C=function(e){var t=e.currentTarget,o=N.indexOf(t),n=p[o].value;k(n),null!=d&&(v(d,n),setTimeout((function(){var e,o,n,r,i,a,s,c;(e=t.getBoundingClientRect(),o=e.top,n=e.left,r=e.bottom,i=e.right,a=window,s=a.innerHeight,c=a.innerWidth,o>=0&&i<=c&&r<=s&&n>=0)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(l),setTimeout((function(){return t.classList.remove(l)}),2e3))}),150))},D=function(e){var t,o;switch(e.keyCode){case c:var n=N.indexOf(e.target)+1;o=N[n]||N[0];break;case s:var r=N.indexOf(e.target)-1;o=N[r]||N[N.length-1]}null==(t=o)||t.focus()};return n.createElement("div",{className:"tabs-container"},n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":o},m)},p.map((function(e){var t=e.value,o=e.label;return n.createElement("li",{role:"tab",tabIndex:b===t?0:-1,"aria-selected":b===t,className:(0,i.Z)("tabs__item",a,{"tabs__item--active":b===t}),key:t,ref:function(e){return N.push(e)},onKeyDown:D,onFocus:C,onClick:C},o)}))),t?(0,n.cloneElement)(y.filter((function(e){return e.props.value===b}))[0],{className:"margin-vert--md"}):n.createElement("div",{className:"margin-vert--md"},y.map((function(e,t){return(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==b})}))))}},79443:function(e,t,o){var n=(0,o(67294).createContext)(void 0);t.Z=n},80944:function(e,t,o){var n=o(67294),r=o(79443);t.Z=function(){var e=(0,n.useContext)(r.Z);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},84661:function(e,t,o){o.r(t),o.d(t,{frontMatter:function(){return l},metadata:function(){return s},toc:function(){return c},default:function(){return p}});var n=o(22122),r=o(19756),i=(o(67294),o(3905)),a=(o(41395),o(58215),o(44996),["components"]),l={title:"CustomResources"},s={unversionedId:"guides/develop-service-crd-en",id:"guides/develop-service-crd-en",isDocsHomePage:!1,title:"CustomResources",description:"Develop CustomResources",source:"@site/docs/guides/develop-service-crd-en.md",sourceDirName:"guides",slug:"/guides/develop-service-crd-en",permalink:"/docs/guides/develop-service-crd-en",editUrl:"https://github.com/nocalhost/nocalhost.github.io/tree/main/docs/guides/develop-service-crd-en.md",version:"current",lastUpdatedBy:"Qi Zhang",lastUpdatedAt:1654589270,formattedLastUpdatedAt:"6/7/2022",frontMatter:{title:"CustomResources"},sidebar:"docs",previous:{title:"DevMode(Duplicate)",permalink:"/docs/guides/develop-service-dup-en"},next:{title:"VPN proxy",permalink:"/docs/guides/develop-service-vpn"}},c=[{value:"Develop CustomResources",id:"develop-customresources",children:[{value:"How it works",id:"how-it-works",children:[]},{value:"How to use",id:"how-to-use",children:[]}]}],u={toc:c};function p(e){var t=e.components,o=(0,r.Z)(e,a);return(0,i.kt)("wrapper",(0,n.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"develop-customresources"},"Develop CustomResources"),(0,i.kt)("p",null,"Nocalhost not only support developing the built-in resources such as Deployment, StatefulSet and Job, but also support developing the ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources"},"CustomResources"),"."),(0,i.kt)("h3",{id:"how-it-works"},"How it works"),(0,i.kt)("p",null,"Under the hood, Nocalhost replaces the container image of pod controlled by ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/architecture/controller/"},"K8s Controller")," with developing container image and upload local source code into the developing container to achieve the developing of Kubernetes resources. When develop a specific kind of Controller (including both Built-in Resources and CustomResources), Nocalhost requires the following three aspects of information:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Pod template path in the Controller's definition. For instance, the template path of the built-in Deployment is ",(0,i.kt)("inlineCode",{parentName:"li"},"/spec/template"),". Nocalhost could use that path to get the Pod template and modify that template by replacing the business images with developing images."),(0,i.kt)("li",{parentName:"ul"},"Do you want Nocalhost to modify the Controller's original Pod template definition or to create a new Deployment based on the original Pod template definition? Since not all of the Controller's Pod template definition could be modified. Job, for example, is unmodifiable. In such a condition, Nocalhost create a new Deployment with the original Pod template definition(which is transparent to users). The Pod template of the newly created Deployment use the developing image instead of the original image. Local source code will be uploaded into that Pod."),(0,i.kt)("li",{parentName:"ul"},"How to make sure the cluster's traffic only visit the developing image in DevMode? A Controller usually manage many Pods. If there are still many Pods after entering DevMode, Nocalhost couldn't make sure that all the cluster's traffic goes through the developing Pod. Hence, Nocalhost will reduce the Pod replicas into 1 in most situations. In terms of the Custom Resources that need to create new Deployment for developing, Nocalhost will reduce the number of the Pod replicas in the original Controller into 0. Take DaemonSet as an example, Nocalhost will delete DaemonSet's Pods altogether through setting the NodeName of DaemonSet's Pods into a non-existent Node.")),(0,i.kt)("p",null,"Nocalhost define how to develop CustomResources by ",(0,i.kt)("inlineCode",{parentName:"p"},"DevModeAction"),". The three fields of ",(0,i.kt)("inlineCode",{parentName:"p"},"DevModeAction")," offer the above three aspects of information. Users can add ",(0,i.kt)("inlineCode",{parentName:"p"},"DevModeAction")," in ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.nh/nhctl/config")," to empower Nocalhost with the ability of developing specific CustomResources. An example of how to configure ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.nh/nhctl/config")," is shown below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'crdDevModeActions:\n- crdType: statefulsets.v1beta1.apps.kruise.io\n  devModeAction:\n    podTemplatePath: /spec/template\n    create: false\n    scalePatches:\n    - type: json\n      patch: \'[{"op":"replace","path":"/spec/replicas","value":1}]\'\n')),(0,i.kt)("p",null,"notes: "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"crdType: The form is ",(0,i.kt)("inlineCode",{parentName:"li"},"resource.version.group"),". The resource/version/group are the resource/version/group of CustomResources respectively, namely GVR in reverse, which is used to specify the corresponding CustomResources type of ",(0,i.kt)("inlineCode",{parentName:"li"},"DevModeAction"),"."),(0,i.kt)("li",{parentName:"ul"},"devModeAction: Used to control the actions to take when specific CustomResources objects enter ",(0,i.kt)("inlineCode",{parentName:"li"},"DevMode"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"podTemplatePath: Specify the path of Pod template definition. Nocalhost will modify that template. For example, replace the containers' image with develop image, add sidcar containers, etc."),(0,i.kt)("li",{parentName:"ul"},"create: Specify if a new Deployment is created in order to develop when CustomResources objects enter ",(0,i.kt)("inlineCode",{parentName:"li"},"DevMode"),".",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"If it's set into ",(0,i.kt)("inlineCode",{parentName:"li"},"true"),", Nocalhost will use the Pod template definition in ",(0,i.kt)("inlineCode",{parentName:"li"},"podTemplatePath")," to create a new Deployment. All of the operations in ",(0,i.kt)("inlineCode",{parentName:"li"},"DevMode")," will be done in that Deployment."),(0,i.kt)("li",{parentName:"ul"},"If it's set into ",(0,i.kt)("inlineCode",{parentName:"li"},"false"),", Nocalhost will modify the Pod template definition of the CustomResources object directly. All of the operations done in ",(0,i.kt)("inlineCode",{parentName:"li"},"DevMode")," will be applied to the CustomeResources object."))),(0,i.kt)("li",{parentName:"ul"},"scalePatches: It specifies the patch that configure the CustomResources object to reduce the amount of replicas into 1 before entering ",(0,i.kt)("inlineCode",{parentName:"li"},"DevMode"),". If the amount of replicas has already been 1 or you don't mean to reduce the amount, then you can ignore this piece of config(refering to ",(0,i.kt)("inlineCode",{parentName:"li"},"How to make sure the cluster's traffic only visit the developing image in DevMode?"),").")))),(0,i.kt)("p",null,"Besides, Nocalhost also has built-in support for several common open-source CustomResources, which includes ",(0,i.kt)("a",{parentName:"p",href:"https://openkruise.io/docs/user-manuals/cloneset/"},"CloneSet")," of ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/openkruise/kruise"},"Kruise"),", ",(0,i.kt)("a",{parentName:"p",href:"https://openkruise.io/docs/user-manuals/advancedstatefulset"},"Advanced StatefulSet"),", ",(0,i.kt)("a",{parentName:"p",href:"https://openkruise.io/docs/user-manuals/advanceddaemonset"},"Advanced DaemonSet")," etc. You can use Nocalhost to develop these CustomResources without configuration."),(0,i.kt)("h3",{id:"how-to-use"},"How to use"),(0,i.kt)("p",null,"Find the ",(0,i.kt)("inlineCode",{parentName:"p"},"CustomResources")," tab in Nocalhost IDE plugin. Expand that tab and you will see the ",(0,i.kt)("inlineCode",{parentName:"p"},"CustomResources")," list.\n",(0,i.kt)("img",{parentName:"p",src:"https://cdn.jsdelivr.net/gh/filess/img0@main/2022/01/12/1641976030414-a509b452-89cf-49de-8495-297d14e89dd2.png",alt:null})),(0,i.kt)("p",null,"Right click the ",(0,i.kt)("inlineCode",{parentName:"p"},"CustomeResources")," that you want to develop. A selection box will pop up. Click the ",(0,i.kt)("inlineCode",{parentName:"p"},"Start DevMode")," to develop:\n",(0,i.kt)("img",{parentName:"p",src:"https://cdn.jsdelivr.net/gh/filess/img12@main/2022/01/12/1641976139936-e651b371-e734-45d5-9785-04d9fb6bf8e6.png",alt:null})),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"The operations of CustomResources objects are in line with built-in resources in Workloads like Deployment/StatefulSet etc.")))}p.isMDXComponent=!0},86010:function(e,t,o){function n(e){var t,o,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(o=n(e[t]))&&(r&&(r+=" "),r+=o);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}function r(){for(var e,t,o=0,r="";o<arguments.length;)(e=arguments[o++])&&(t=n(e))&&(r&&(r+=" "),r+=t);return r}o.d(t,{Z:function(){return r}})}}]);